/* Page header styles for responsive design */
.page-header {
  /* Inline styles used in code were replaced by a class to make responsive rules clearer */
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}
@media (max-width: 840px) {
  .page-header { flex-direction: column; align-items: flex-start; }
}

/* Compact card: reduced paddings and less pronounced border for nested/summary sections */
.card.compact {
  padding: var(--gap-1) !important;
  border-radius: 8px !important;
  border: 1px solid rgba(34,34,34,0.75) !important;
  background: rgba(8,8,8,0.85) !important;
}
@media (max-width: 840px) {
  .card.compact { padding: 8px !important; border: none !important; background: transparent !important; }
}

:root {
  /* Design tokens for compact mobile-first layout */
  font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  color: #f8f9fa;
  background-color: var(--bg-dark);
  font-size: 14px;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  background: radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.05), transparent 60%), var(--bg-dark);
  color: inherit;
}

/* Prevent visual overflow of the viewport on mobile devices */
@media (max-width: 840px) {
  html, body, #root { max-width: 100vw; overflow-x: hidden; }
}

/* Pager behavior: horizontal swiping via .pager-inner remains enabled on mobile; ensure page content still fits */

button {
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--bg-dark);
  color: inherit;
  padding: 0.28rem 0.6rem;
  cursor: pointer;
  font-size: 0.92rem;
}

button:hover {
  border-color: var(--accent);
}

main {
  padding-bottom: 3rem;
}

.app-shell {
  width: min(100%, 1100px);
  margin: 0 auto;
  padding: 0.6rem;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.ops-toolbar,
.ops-save {
  display: flex;
  gap: 8px;
  align-items: center;
}

.ops-toolbar {
  flex-wrap: wrap;
  width: 100%;
  justify-content: flex-start;
  margin-top: 8px;
}

.ops-save {
  flex-wrap: wrap;
  flex: 1 1 320px;
  margin-left: 0;
  width: 100%;
}

.ops-save input {
  flex: 1 1 180px;
  min-width: 0;
}

/* Pager and mobile-forward layout */
:root {
  --app-header-height: 7.5rem; /* adjust if header size changes */
}

.pager {
  width: 100%;
  overflow: hidden;
  position: relative;
  touch-action: pan-y;
}

.pager-inner {
  display: flex;
  flex-direction: row;
  transition: transform 320ms cubic-bezier(.2,.8,.2,1);
  will-change: transform;
}
.pager-inner { cursor: grab; }
.pager-inner:active { cursor: grabbing; }
.pager-inner.disable-pointer-events { pointer-events: none; }

.page {
  flex: 0 0 100%;
  width: 100%;
  padding: 1rem;
  box-sizing: border-box;
  max-width: 100%;
  overflow-x: hidden;
}

/* Make pages use viewport height and scroll internally on small screens so
   content doesn't force the page wider than the viewport. Adjust the
   subtraction value if your header or pager sizes change. */
.page {
  /* Use the header height variable so we can tune across devices */
  height: calc(100vh - var(--app-header-height));
  max-height: calc(100vh - var(--app-header-height));
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain; /* lock overscroll to the page container */
}
.pager-nav {
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  margin: 0.5rem 0 1rem 0;
}
.pager-dot {
  width:10px;height:10px;border-radius:50%;background:#2a2a2a;opacity:0.5;
}
.pager-dot.active{background:#7b78ff;opacity:1;transform:scale(1.35);transition:transform 220ms}
.pager-dot{transition:transform 220ms, opacity 180ms}

.pager-item{display:flex;flex-direction:column;align-items:center;gap:6px;min-width:48px}
.pager-label{font-size:0.8rem;color:var(--muted)}
.pager-item[aria-current='true'] .pager-label{color:#7b78ff;font-weight:600}

/* Shared card grids */
.card-grid {
  display: grid;
  gap: 8px;
}

/* Compact grid variant: tighter gap and edge-to-edge content for dense lists */
.card-grid.compact { gap: var(--gap-small); padding: 0; background: transparent; border: none; }

/* Compact visual rules: prefer edge-to-edge lists in compact mode */
.card-grid.compact .card { border: none; background: transparent; border-radius: 0; padding: var(--gap-1) 0; }
.section.compact, section.compact { padding: var(--gap-1) 0; border: none; background: transparent; }
.card-grid.compact .card.base-card { padding: var(--gap-1) 0; }

.card-grid.base-card-grid {
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 8px;
}

.card-grid.mod-card-grid {
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

/* Card-like containers */
.card {
  border:1px solid #333;
  border-radius:8px;
  padding: var(--gap-1);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.1));
  min-width: 0; /* allow grid children to shrink on mobile */
  word-break: break-word;
  overflow-wrap: anywhere;
  width: 100%;
  box-sizing: border-box;
  overflow-x: hidden; /* ensure card content cannot overflow horizontally */
  max-width: 100%;
}

.card * {
  min-width: 0; /* prevent child content (dd, dt, divs) from causing overflow */
}

/* Compact header and counter layout for card items */
.card-header { display:flex;align-items:center;justify-content:space-between;gap:6px;flex-wrap:nowrap }
.card-title {
  min-width: 0;
  flex: 1 1 auto;
  overflow: hidden;
}
.card-title .card-name { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight:700; font-size: var(--type-section); }
.card-controls {
  display: flex;
  gap: 6px;
  align-items: center;
  flex: 0 0 auto;
}
.counter-btn { width: var(--counter-size); height: var(--counter-size); padding: 0; font-size: 0.9rem; }
.counter-value {
  min-width: 20px;
  text-align: center;
}

.counter-inline {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.counter-inline .counter-btn {
  width: 32px;
  height: 32px;
}
.counter-pill {
  min-width: 42px;
  padding: 2px 12px;
  text-align: center;
  border-radius: 999px;
  border: 1px solid var(--border);
  background: rgba(255,255,255,0.05);
  font-weight: 600;
}

.hand-stack {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.hand-card {
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 10px;
  padding: 12px;
  background: rgba(0,0,0,0.4);
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.hand-meta {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}
.hand-title {
  font-size: 1rem;
  font-weight: 600;
}
.hand-subtitle {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
  font-size: 0.85rem;
  color: var(--muted);
}
.hand-type {
  text-transform: uppercase;
  letter-spacing: 0.04em;
  font-size: 0.72rem;
}
.hand-count {
  font-weight: 600;
}
.hand-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.hand-pill {
  padding: 2px 10px;
  border-radius: 999px;
  border: 1px solid var(--accent);
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.04em;
}
.hand-hint {
  font-size: 0.8rem;
  color: var(--muted);
}


/* Ensure the header row of cards allows the left content to shrink and the right controls to remain anchored inside the border */
.card > div > div:first-child { min-width:0; flex: 1 1 auto; }
.card > div > div:last-child { flex: 0 0 auto; min-width:0; }
/* Prevent the left header content from growing too large and pushing action buttons beyond the right edge */
.card > div > div:first-child { max-width: calc(100% - 120px); }
@media (max-width: 520px) {
  .card > div > div:first-child { max-width: calc(100% - 96px); }
}
/* Ensure long header line wraps inside the left column to avoid pushing right controls out */
.card > div > div:first-child { overflow-wrap: anywhere; word-break: break-word; white-space: normal; }

/* Base-card-specific header adjustments to ensure control buttons remain inside the card border */
.card-grid.base-card-grid .card > div { overflow: hidden; }
.card-grid.base-card-grid .card > div > div:last-child { display: flex; align-items: center; gap: 6px; flex: 0 0 auto; }
.card-grid.base-card-grid .card > div > div:last-child button { min-width: 28px; width: 28px; height: 28px; padding: 0; box-sizing: border-box; }
.card-grid.base-card-grid .card > div > div:last-child button svg, .card-grid.base-card-grid .card > div > div:last-child button span { display:block; width:100%; height:100%; }


/* Selected / highlight state */
.card.is-selected { border-color: #7b78ff; box-shadow: none; }
/* Class-based sizing and padding rules for base and mod cards */
.card.base-card { padding: calc(var(--gap-1) + 2px) calc(var(--gap-2)); border-radius: 8px; }
.card.mod-card { padding: calc(var(--gap-1) + 2px); border-radius: 8px; }
.card.small-card { padding: var(--gap-1); border-radius: 8px; }

/* Base-card header override for explicit scoping */
.card.base-card > div { overflow: hidden; }
.card.base-card > div > div:first-child { min-width: 0; flex: 1 1 auto; }
.card.base-card > div > div:last-child { flex: 0 0 auto; min-width: 0; margin-left: 12px; }

/* Debug class overlays element bounds: only visible when ?debug=overflow is set */
.debug-overflow * {
  outline: 1px dashed rgba(255,64,64,0.2);
}
.debug-overflow .card { outline: 2px solid rgba(255, 64, 64, 0.25); }

.card dl dt,
.card dl dd {
  overflow-wrap: anywhere;
  word-break: break-word;
  white-space: normal;
}

/* Compact font scaling for dense lists */
.card-grid.compact .card p, .card-grid.compact .card .card-details, .card-grid.compact .card .row-meta { font-size: var(--type-body); color: var(--muted); }

/* Utility text classes using centralized tokens */
.text-page { font-size: var(--type-page); }
.text-section { font-size: var(--type-section); }
.text-body { font-size: var(--type-body); }
.text-footnote { font-size: var(--type-footnote); }
.stat-large { font-size: var(--stat-large); font-weight: 700; }
.muted { color: var(--muted); }
.accent { color: var(--accent); }
.status-success { color: var(--success); }
.status-warning { color: var(--warning); }
.status-error { color: var(--error); }
.card-name { font-weight: 700; }
.weight-600 { font-weight: 600; }
.label-strong { font-weight: 600; font-size: var(--type-section); }

/* Details grid class; default layout uses two columns (label/value) */
.card-details { display: grid; grid-template-columns: auto 1fr; column-gap: 8px; row-gap: 4px; align-items: center; }
.card-details dt, .card-details dd { margin: 0; }
/* Keep two-column metadata layout even on narrow screens but keep label narrow and values flexible */
@media (max-width: 1400px) {
  .card-details { grid-template-columns: 120px 1fr; }
}

/* More aggressive stacking on phone-sized viewports to avoid label/value wide columns */
/* Keep two-column metadata in compact grids; switch to single column only if space is extreme */
@media (max-width: 1080px) {
  .card-details { grid-template-columns: 1fr; }
}

/* For compact card grids, prefer a tighter 2-column layout for metadata to maximize density */
.card-grid.compact .card-details { grid-template-columns: 1fr 1fr; column-gap: 6px; row-gap: 2px; }
@media (max-width: 520px) {
  .card-grid.compact .card-details { grid-template-columns: 1fr 1fr; }
}

/* Label column sizing: give dt a max width to prevent large left column from forcing horizontal layout */
.card dl dt { max-width: 120px; min-width: 56px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card dl dd { max-width: calc(100% - 140px); overflow: hidden; text-overflow: ellipsis; }

/* Tighter label widths for base cards to reduce content wrap */
.card-grid.base-card-grid .card .card-details dt { max-width: 18%; min-width: 60px; }
.card-grid.base-card-grid .card .card-details dd { max-width: 82%; }

/* Ensure images and svgs do not overflow cards */
.card img, .card svg { max-width: 100%; height: auto; display: block; }

/* Mobile first adjustments */
@media (max-width: 840px) {
  .app-shell {
    width: min(100%, 520px);
    padding: 0.5rem 0 6.5rem;
  }
  .card { padding:10px; }
  button { padding: 0.5rem 0.85rem; }
  main { padding: 0.5rem; }
  .card-grid { grid-template-columns: minmax(0, 1fr) !important; }
  .card-grid.base-card-grid .card { max-width: calc(100% - 16px); }
  .ops-save button,
  .ops-toolbar button {
    flex: 1 1 140px;
  }
  /* Sticky pager: mobile-first bottom nav that stays visible while interacting */
  .pager-nav {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
    background: linear-gradient(180deg, rgba(0,0,0,0.85), rgba(0,0,0,0.95));
    padding: 10px 12px;
    margin: 0;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.5);
  }
  /* Ensure page content doesn't get covered by fixed pager */
  main { padding-bottom: 6.5rem; }
  /* Prevent any accidental horizontal overflow in page content */
  .page, .app-shell { overflow-x: hidden; }
  .page * { min-width: 0; max-width: 100%; }
}

/* Ensure consistent horizontal gutters on small/medium screens: rely on .page
   padding for consistent left/right spacing and remove app-shell horizontal
   padding which caused uneven left-side spacing. */
@media (max-width: 1080px) {
  .app-shell { padding-inline: 0 !important; }
  .page { padding-left: clamp(16px, 4vw, 24px) !important; padding-right: clamp(16px, 4vw, 24px) !important; }
}

/* Narrow phone-specific adjustments */
@media (max-width: 520px) {
  /* Always single column */
  .card-grid.base-card-grid, .card-grid.mod-card-grid { grid-template-columns: 1fr !important; }
  .card { padding: 8px 10px; }
  .app-shell { width: min(100%, 480px); }
}

/* More aggressive single-column enforcement for phones and larger phones in landscape */
@media (max-width: 980px) {
  .card-grid.base-card-grid, .card-grid.mod-card-grid { grid-template-columns: 1fr !important; }
  .app-shell { width: 100%; padding: 0.5rem; }
}

/* Stack labels/values into rows if the screen is narrow */
@media (max-width: 1400px) {
  .card dl { grid-template-columns: 1fr; grid-auto-flow: row; }
  .card dl dt { grid-column: 1; margin-top: 6px; }
  .card dl dd { grid-column: 1; margin-left: 0; }
  .card p, .card div, .card span { word-break: break-word; overflow-wrap: anywhere; }
  .card * { max-width: 100%; }
  .card-grid > * { width: 100%; min-width: 0; max-width: 100%; }
  .card button { min-width: 0; }
}

/* defensive mobile layout to guarantee no bleed on any phone width */
@media (max-width: 1400px) {
  html, body, #root, .app-shell, .page { max-width: 100vw !important; overflow-x: hidden !important; }
  .pager { overflow-x: hidden !important; }
  /* ensure page content clamps to viewport for any transform based pager */
  .page { max-width: calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right)); }
  /* Force single column for cards */
  .card-grid.base-card-grid, .card-grid.mod-card-grid { grid-template-columns: 1fr !important; }
  /* shrink label column more on medium widths */
  .card dl dt { max-width: 20%; min-width: 56px; }
  .card dl dd { max-width: 80%; }
}

/* Increase page gutters for mobile to avoid edge glancing */
@media (max-width: 1080px) {
  .page { padding-left: clamp(16px, 4vw, 24px) !important; padding-right: clamp(16px, 4vw, 24px) !important; }
  .app-shell { padding-left: clamp(12px, 3vw, 20px) !important; padding-right: clamp(12px, 3vw, 20px) !important; }
  /* ensure card grid has internal gutters */
  .card-grid.base-card-grid { padding-left: 12px; padding-right: 12px; }
}

/* Target 1080x1920 and smaller devices (common Full HD mobile) */
@media (max-width: 1080px) {
  .app-shell { width: 100%; max-width: 1080px; padding: 0.75rem; }
  .card-grid.base-card-grid, .card-grid.mod-card-grid { grid-template-columns: 1fr !important; }
  .card { width: 100%; padding: 10px 12px; }
  h1 { font-size: clamp(1.6rem, 4vw, 2.4rem); }
  h2 { font-size: clamp(1.2rem, 3.5vw, 1.6rem); }
  .card dl dt { max-width: 28%; min-width: 70px; }
  .card dl dd { max-width: 72%; }
  .card p, .card dl, .card div { font-size: clamp(0.8rem, 2.4vw, 1rem); }
  .page, .app-shell { overflow-x: hidden; }
  .card { box-sizing: border-box; }
}

/* Add a little more right padding to keep action buttons comfortably inside card bounds */
@media (max-width: 1080px) {
  .card { padding-right: clamp(12px, 4vw, 20px) !important; }
  /* More aggressive right padding for base cards on mobile; include safe-area insets */
  .card.base-card { padding-inline-end: calc(clamp(18px, 6vw, 28px) + env(safe-area-inset-right, 0px)) !important; }
}

/* Extra padding on very narrow devices to ensure visual padding even when safe-area is limited */
@media (max-width: 420px) {
  .card.base-card { padding-inline-end: calc(22px + env(safe-area-inset-right, 0px)) !important; }
}

/* PWA (standalone) display mode often has different viewports and no browser chrome; add extra padding */
@media (display-mode: standalone) {
  .card.base-card { padding-inline-end: calc(22px + env(safe-area-inset-right, 0px)) !important; }
}

@media (max-width: 420px) and (display-mode: standalone) {
  .card.base-card { padding-inline-end: calc(28px + env(safe-area-inset-right, 0px)) !important; }
}

/* Ensure base card horizontal padding prevents edge touching on various phones */
@media (max-width: 1080px) {
  .card-grid.base-card-grid .card {
    padding-left: clamp(12px, 4vw, 18px) !important;
    padding-right: clamp(12px, 4vw, 18px) !important;
  }
  /* Force label column restraint for base cards (override broader rules) */
  .card-grid.base-card-grid .card .card-details dt { max-width: 18% !important; min-width: 56px; }
  .card-grid.base-card-grid .card .card-details dd { max-width: 82% !important; }
}

/* Permanent horizontal pager: always position pages in a single row and move
  the track using a translateX transform controlled via the CSS variable
  `--pager-offset` (value in percentage, e.g. 0% or 100%). This keeps layout
  stable, performant and avoids scrollLeft-based movement. */
.pager-inner { transform: translateX(calc(-1 * var(--pager-offset, 0%))); }

/* defensive mobile layout: ensure pages are viewport-locked and cannot cause
  horizontal bleed. Keep this rule active for all sizes to make the horizontal
  layout permanent and predictable. */
html, body, #root { width: 100%; height: 100%; overflow-x: hidden; }

/* Make sure the pager nav (sticky bottom) doesn't cover page content by
  providing bottom padding via the main/app-shell when needed. */

/* Fallback for very small devices where Safari visual viewport might cause overflow: ensure card content fits by shrinking font and spacing */
@media (max-width: 400px) {
  .card { padding: 8px; }
  .card h3, .card h2, .card h1 { font-size: clamp(1rem, 4vw, 1.2rem) !important; }
  .card dl { font-size: 0.75rem; }
}

/* Reduce heading and large numeric font sizes on narrower screens to prevent overflow */
@media (max-width: 600px) {
  h1, h2, h3 { font-size: clamp(1rem, 3.5vw, 1.6rem); }
  .card .muted, .card p, .card dl { font-size: clamp(0.75rem, 2.6vw, 0.95rem); }
}

code {
  font-family: 'JetBrains Mono', 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
}
